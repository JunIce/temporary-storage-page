<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>Êñá‰ª∂Á≥ªÁªü</title>
    <style>
        /* CSSÂèòÈáèÂÆö‰πâ */
        :root {
            --primary-color: #4e54c8;
            --secondary-color: #8f94fb;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-radius: 12px;
            --border-radius-lg: 20px;
            --border-radius-xl: 25px;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --box-shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }

        /* --- ÂÖ®Â±ÄÈáçÁΩÆ‰∏éÂü∫Á°ÄÊ†∑Âºè --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            /* Áªü‰∏Ä‰ΩøÁî®ÊÄùÊ∫êÈªë‰Ωì/ËãπÊñπÁ≠âÁé∞‰ª£‰∏≠ÊñáÂ≠ó‰Ωì */
            font-family: 'PingFang SC', 'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
            /* Êõ¥ÊúâÊ¥ªÂäõÁöÑËÉåÊôØÊ∏êÂèò */
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            /* ÁßªÂä®Á´Ø‰ºòÂåñ */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        /* --- ‰∏ªÂÆπÂô®Ê†∑Âºè --- */
        .container {
            /* Êõ¥ÊüîÂíåÁöÑÁôΩËâ≤ÈÄèÊòéÂ∫¶ */
            background: rgba(255, 255, 255, 0.98);
            border-radius: 25px; /* Â¢ûÂä†ÂúÜËßí */
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.5) inset; /* Êõ¥Â•ΩÁöÑÈò¥ÂΩ± */
            padding: 40px;
            max-width: 850px;
            width: 100%;
            backdrop-filter: blur(15px); /* Áï•ÂæÆÂ¢ûÂº∫Ê®°Á≥äÊïàÊûú */
        }

        /* --- Ê†áÈ¢òÊ†∑Âºè --- */
        h1 {
            text-align: center;
            margin-bottom: 40px;
            font-size: 2.8em;
            /* ‰øùÊåÅÊ∏êÂèòÊñáÊú¨ÊïàÊûú */
            background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800; /* Âä†Á≤ó */
            letter-spacing: 1px;
        }

        /* --- ‰∏ä‰º†Âå∫ÂüüÊ†∑Âºè --- */
        .upload-area {
            border: 4px dashed #667eea; /* Á®çÂæÆÁ≤ó‰∏ÄÁÇπÁöÑËôöÁ∫ø */
            border-radius: 20px;
            padding: 50px 40px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer;
            background: #ffffff;
            margin-bottom: 30px;
            color: #6c757d;
            font-size: 1.1em;
            font-weight: 500;
        }

        .upload-area:hover {
            border-color: #4e54c8;
            background: #f5f7fa;
        }

        .upload-area.dragover {
            border-color: #4e54c8;
            background: #e9ecef;
            transform: scale(1.01);
            box-shadow: 0 0 0 8px rgba(78, 84, 200, 0.1);
        }

        .upload-icon {
            font-size: 5em; /* Áï•ÂæÆÂ¢ûÂ§ßÂõæÊ†á */
            color: #667eea;
            margin-bottom: 20px;
            line-height: 1;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(78, 84, 200, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            min-width: 100px;
            justify-content: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 84, 200, 0.4);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(78, 84, 200, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }



        .uploading-animation {
            display: inline-block;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; } /* Á®çÂæÆÈôç‰ΩéÊúÄÂ∞è‰∏çÈÄèÊòéÂ∫¶ */
            100% { opacity: 1; }
        }

        /* --- Áªü‰∏Ä‰∏ä‰º†Âç°ÁâáÊ†∑Âºè --- */
        .upload-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid #e9ecef;
            border-radius: 20px;
            padding: 0;
            margin: 20px 0;
            display: none;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            position: relative;
        }

        .upload-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4e54c8 0%, #8f94fb 100%);
        }

        .upload-card-header {
            padding: 25px 30px 20px;
            border-bottom: 1px solid #f1f3f4;
            background: rgba(78, 84, 200, 0.03);
        }

        .upload-card-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-card-title::before {
            content: 'üìÑ';
            font-size: 1.1em;
        }

        .file-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 10px;
        }

        .file-info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .file-info-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .file-info-value {
            font-size: 14px;
            color: #333;
            font-weight: 600;
            word-break: break-all;
        }

        .upload-card-body {
            padding: 25px 30px;
        }

        .progress-section {
            margin-bottom: 25px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-title::before {
            content: '‚è≥';
            font-size: 1em;
        }

        .progress-percentage {
            font-size: 1.3em;
            font-weight: 800;
            color: #4e54c8;
            background: rgba(78, 84, 200, 0.1);
            padding: 5px 12px;
            border-radius: 20px;
            min-width: 60px;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4e54c8 0%, #8f94fb 100%);
            width: 0%;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border-radius: 6px;
        }

        .progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.6),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(400%); }
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: rgba(78, 84, 200, 0.05);
            border-radius: 15px;
        }

        .stat-item.upload-speed {
            color: #28a745;
        }

        .stat-item.chunk-info {
            color: #4e54c8;
        }

        .stat-item.time-remaining {
            color: #dc3545;
        }

        .upload-card-footer {
            padding: 20px 30px 25px;
            background: rgba(78, 84, 200, 0.02);
            border-top: 1px solid #f1f3f4;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* --- ÂéÜÂè≤ËÆ∞ÂΩïÊ†∑Âºè --- */
        .history {
            margin-top: 40px;
        }

        .history h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 700;
        }

        .history-item {
            background: #ffffff;
            padding: 18px 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .history-item:hover {
            background: #f5f7fa;
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .history-info {
            flex: 1;
        }

        .history-name {
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .history-meta {
            font-size: 13px;
            color: #777;
        }

        .history-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .history-item-link {
            color: white;
            background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
            text-decoration: none;
            padding: 8px 18px;
            border: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 13px;
        }

        .history-item-link:hover {
            opacity: 0.9;
            box-shadow: 0 4px 10px rgba(78, 84, 200, 0.3);
        }

        .btn-resume, .btn-cancel {
            /* Áªü‰∏ÄÂ∞èÊåâÈíÆÊ†∑Âºè */
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
        }

        .btn-resume {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }

        .btn-resume:hover {
            background: linear-gradient(135deg, #218838 0%, #1ba87e 100%);
            transform: translateY(-1px);
        }

        .btn-cancel {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
        }

        .btn-cancel:hover {
            background: linear-gradient(135deg, #c82333 0%, #fd9843 100%);
            transform: translateY(-1px);
        }

        /* --- ÂºπÁ™óÊ†∑Âºè --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            position: relative;
            margin: 20px;
        }

        @keyframes slideIn {
            from { 
                transform: translateY(-50px) scale(0.9);
                opacity: 0;
            }
            to { 
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .modal-icon {
            font-size: 2em;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .modal-icon.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .modal-icon.error {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }

        .modal-icon.info {
            background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
            color: white;
        }

        .modal-title {
            font-size: 1.4em;
            font-weight: 700;
            color: #333;
            margin: 0;
        }

        .modal-body {
            color: #666;
            font-size: 1em;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(78, 84, 200, 0.3);
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 84, 200, 0.4);
        }

        .modal-btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #e9ecef;
        }

        .modal-btn-secondary:hover {
            background: #e9ecef;
        }

        /* --- ÂéÜÂè≤ËÆ∞ÂΩïÁä∂ÊÄÅÊ†∑Âºè --- */
        .history-item.uploading {
            border-left: 4px solid #ffc107;
            background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
        }

        .history-item.completed {
            border-left: 4px solid #28a745;
            background: linear-gradient(135deg, #e8f5e8 0%, #ffffff 100%);
        }

        .history-item.failed {
            border-left: 4px solid #dc3545;
            background: linear-gradient(135deg, #ffeaea 0%, #ffffff 100%);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.uploading {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: white;
        }

        .status-badge.completed {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .status-badge.failed {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }

        /* --- ÂéÜÂè≤ËÆ∞ÂΩïÊ†∑Âºè --- */
        .history {
            margin-top: 40px;
        }

        .history h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 700;
        }

        .history-item {
            background: #ffffff;
            padding: 18px 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .history-item:hover {
            background: #f5f7fa;
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .history-info {
            flex: 1;
        }

        .history-name {
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .history-meta {
            font-size: 13px;
            color: #777;
        }

        .history-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .history-item-link {
            color: white;
            background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
            text-decoration: none;
            padding: 8px 18px;
            border: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 13px;
        }

        .history-item-link:hover {
            opacity: 0.9;
            box-shadow: 0 4px 10px rgba(78, 84, 200, 0.3);
        }

        .btn-resume, .btn-cancel {
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
        }

        .btn-resume {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }

        .btn-resume:hover {
            background: linear-gradient(135deg, #218838 0%, #1ba87e 100%);
            transform: translateY(-1px);
        }

        .btn-cancel {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
        }

        .btn-cancel:hover {
            background: linear-gradient(135deg, #c82333 0%, #fd9843 100%);
            transform: translateY(-1px);
        }

        /* --- ÂºπÁ™óÊ†∑Âºè --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            position: relative;
            margin: 20px;
        }

        @keyframes slideIn {
            from { 
                transform: translateY(-50px) scale(0.9);
                opacity: 0;
            }
            to { 
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .modal-icon {
            font-size: 2em;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .modal-icon.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .modal-icon.error {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }

        .modal-icon.info {
            background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
            color: white;
        }

        .modal-title {
            font-size: 1.4em;
            font-weight: 700;
            color: #333;
            margin: 0;
        }

        .modal-body {
            color: #666;
            font-size: 1em;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(78, 84, 200, 0.3);
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 84, 200, 0.4);
        }

        .modal-btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #e9ecef;
        }

        .modal-btn-secondary:hover {
            background: #e9ecef;
        }

        /* --- ÂéÜÂè≤ËÆ∞ÂΩïÁä∂ÊÄÅÊ†∑Âºè --- */
        .history-item.uploading {
            border-left: 4px solid #ffc107;
            background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
        }

        .history-item.completed {
            border-left: 4px solid #28a745;
            background: linear-gradient(135deg, #e8f5e8 0%, #ffffff 100%);
        }

        .history-item.failed {
            border-left: 4px solid #dc3545;
            background: linear-gradient(135deg, #ffeaea 0%, #ffffff 100%);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.uploading {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: white;
        }

        .status-badge.completed {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .status-badge.failed {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }

        /* --- Áä∂ÊÄÅ‰ø°ÊÅØÊ†∑Âºè --- */
        .status {
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 15px;
            margin: 15px 0;
            display: none;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .controls {
            text-align: center;
            margin: 30px 0;
        }

        /* ‰øÆÂ§çÂéüÊù•ÁöÑÊ†∑Âºè‰∏≠ÈáçÂ§çÂÆö‰πâÁöÑ formatFileSize */
        .chunk-info {
            font-size: 13px; /* Ë∞ÉÊï¥‰∏∫‰∏é progress-stats ‰∏≠ÁöÑÂÆö‰πâ‰∏ÄËá¥ */
            color: #4e54c8;
            margin-top: 0; /* ÁßªÈô§Â§ö‰ΩôÁöÑ margin-top */
        }

        /* --- Êñá‰ª∂‰øùÂ≠òÊúüÈôêÊèêÁ§∫Ê†∑Âºè --- */
        .storage-notice {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(238, 90, 82, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            z-index: 100;
            animation: slideInLeft 0.5s ease-out;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 300px;
        }

        .notice-icon {
            font-size: 16px;
            animation: pulse 2s infinite;
        }

        .notice-text {
            flex: 1;
            line-height: 1.4;
        }

        @keyframes slideInLeft {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            /* ÂÆπÂô®Ë∞ÉÊï¥ */
            .container {
                padding: 20px;
                margin: 10px;
                max-width: none;
                width: calc(100% - 20px);
            }

            /* Ê†áÈ¢òË∞ÉÊï¥ */
            h1 {
                font-size: 24px;
                margin-bottom: 20px;
            }

            h2 {
                font-size: 20px;
                margin-bottom: 15px;
            }

            /* ‰∏ä‰º†Âå∫ÂüüË∞ÉÊï¥ */
            .upload-area {
                padding: 40px 20px;
                min-height: 120px;
            }

            .upload-icon {
                font-size: 48px;
                margin-bottom: 15px;
            }

            .upload-area p {
                font-size: 16px;
                margin: 0;
            }

            /* ‰∏ä‰º†Âç°ÁâáË∞ÉÊï¥ */
            .upload-card {
                margin: 20px 0;
                padding: 20px;
            }

            .upload-card-header {
                margin-bottom: 20px;
            }

            .upload-card-title {
                font-size: 18px;
                margin-bottom: 15px;
            }

            /* Êñá‰ª∂‰ø°ÊÅØÁΩëÊ†ºË∞ÉÊï¥ */
            .file-info-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .file-info-item {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                background: rgba(78, 84, 200, 0.05);
                border-radius: 8px;
            }

            .file-info-label {
                font-size: 13px;
                color: #666;
                margin-bottom: 0;
            }

            .file-info-value {
                font-size: 14px;
                font-weight: 600;
                text-align: right;
                word-break: break-all;
                max-width: 60%;
            }

            /* ËøõÂ∫¶Êù°Ë∞ÉÊï¥ */
            .progress-section {
                margin: 20px 0;
            }

            .progress-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
                margin-bottom: 15px;
            }

            .progress-title {
                font-size: 16px;
            }

            .progress-percentage {
                font-size: 18px;
                align-self: flex-end;
            }

            .progress-bar {
                height: 8px;
                margin-bottom: 15px;
            }

            /* ËøõÂ∫¶ÁªüËÆ°Ë∞ÉÊï¥ */
            .progress-stats {
                flex-direction: column;
                gap: 10px;
            }

            .stat-item {
                justify-content: space-between;
                padding: 8px 12px;
                background: rgba(78, 84, 200, 0.05);
                border-radius: 6px;
            }

            .stat-item span:first-child {
                font-size: 14px;
            }

            .stat-item span:last-child {
                font-size: 12px;
                font-weight: 600;
            }

            /* ÊåâÈíÆÁªÑË∞ÉÊï¥ */
            .controls {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
                margin: 20px 0;
            }

            .btn {
                flex: 1;
                min-width: calc(50% - 5px);
                max-width: calc(50% - 5px);
                padding: 12px 16px;
                font-size: 14px;
            }

            .btn-secondary {
                min-width: calc(33.33% - 7px);
                max-width: calc(33.33% - 7px);
            }

            .btn-danger {
                min-width: calc(33.33% - 7px);
                max-width: calc(33.33% - 7px);
            }

            /* ÂéÜÂè≤ËÆ∞ÂΩïË∞ÉÊï¥ */
            .history {
                margin: 20px 0;
            }

            .history-item {
                padding: 15px;
                margin-bottom: 10px;
            }

            .history-item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .history-item-name {
                font-size: 14px;
                word-break: break-all;
            }

            .history-item-meta {
                font-size: 12px;
            }

            /* ÂºπÁ™óË∞ÉÊï¥ */
            .modal-content {
                margin: 20px;
                padding: 20px;
                max-width: calc(100vw - 40px);
                width: calc(100vw - 40px);
            }

            .modal-header {
                margin-bottom: 15px;
            }

            .modal-title {
                font-size: 18px;
            }

            .modal-body {
                font-size: 14px;
                margin-bottom: 20px;
            }

            .modal-btn {
                padding: 12px 24px;
                font-size: 14px;
            }

            /* Êñá‰ª∂‰øùÂ≠òÊúüÈôêÊèêÁ§∫Ë∞ÉÊï¥ */
            .storage-notice {
                bottom: 15px;
                left: 15px;
                right: 15px;
                max-width: none;
                font-size: 13px;
                padding: 12px 15px;
                border-radius: 8px;
            }
        }

        /* Ë∂ÖÂ∞èÂ±èÂπï‰ºòÂåñ (iPhone SEÁ≠â) */
        @media (max-width: 375px) {
            .container {
                padding: 15px;
                margin: 5px;
                width: calc(100% - 10px);
            }

            h1 {
                font-size: 20px;
            }

            .upload-area {
                padding: 30px 15px;
                min-height: 100px;
            }

            .upload-icon {
                font-size: 40px;
            }

            .upload-area p {
                font-size: 14px;
            }

            .btn {
                padding: 10px 12px;
                font-size: 13px;
            }

            .file-info-value {
                font-size: 12px;
            }

            .storage-notice {
                font-size: 12px;
                padding: 10px 12px;
            }

            /* ÁßªÂä®Á´ØËß¶Êë∏‰ºòÂåñ */
            .btn {
                min-height: 44px; /* iOSÊé®ËçêÁöÑÊúÄÂ∞èËß¶Êë∏ÁõÆÊ†á */
                touch-action: manipulation; /* Á¶ÅÁî®ÂèåÂáªÁº©Êîæ */
                user-select: none; /* Èò≤Ê≠¢ÊñáÊú¨ÈÄâÊã© */
                -webkit-tap-highlight-color: transparent; /* ÁßªÈô§ÁÇπÂáªÈ´ò‰∫Æ */
            }

            .upload-area {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }

            /* ÁßªÂä®Á´ØÊªöÂä®‰ºòÂåñ */
            body {
                -webkit-overflow-scrolling: touch; /* iOSÂπ≥ÊªëÊªöÂä® */
                overscroll-behavior: contain; /* Èò≤Ê≠¢ËøáÂ∫¶ÊªöÂä® */
            }

            /* ÁßªÂä®Á´ØËæìÂÖ•‰ºòÂåñ */
            .file-input {
                touch-action: manipulation;
            }
        }

        /* Ê®™Â±èÊ®°Âºè‰ºòÂåñ */
        @media (max-width: 768px) and (orientation: landscape) {
            .container {
                padding: 15px;
            }

            .upload-area {
                padding: 20px 15px;
                min-height: 80px;
            }

            .upload-icon {
                font-size: 36px;
                margin-bottom: 10px;
            }

            .upload-area p {
                font-size: 14px;
            }

            .file-info-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .progress-stats {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 8px;
            }

            .stat-item {
                flex: 1;
                min-width: calc(33.33% - 6px);
            }

            .btn {
                min-width: 80px;
                max-width: 120px;
            }
        }

        /* Âπ≥ÊùøËÆæÂ§á‰ºòÂåñ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                padding: 30px;
                margin: 20px auto;
                max-width: 90%;
            }

            .file-info-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .controls {
                gap: 15px;
            }

            .btn {
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Êñá‰ª∂Á≥ªÁªü</h1>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">üìÅ</div>
            <p>ÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§ÑÊàñÁÇπÂáªÈÄâÊã©Êñá‰ª∂</p>
            <input type="file" id="fileInput" class="file-input">
        </div>

        <div class="upload-card" id="uploadCard">
            <div class="upload-card-header">
                <h3 class="upload-card-title">Êñá‰ª∂‰ø°ÊÅØ</h3>
                <div class="file-info-grid">
                    <div class="file-info-item">
                        <span class="file-info-label">Êñá‰ª∂Âêç</span>
                        <span class="file-info-value" id="fileName">-</span>
                    </div>
                    <div class="file-info-item">
                        <span class="file-info-label">Êñá‰ª∂Â§ßÂ∞è</span>
                        <span class="file-info-value" id="fileSize">-</span>
                    </div>
                    <div class="file-info-item">
                        <span class="file-info-label">Êñá‰ª∂Á±ªÂûã</span>
                        <span class="file-info-value" id="fileType">-</span>
                    </div>
                    <div class="file-info-item">
                        <span class="file-info-label">ÊúÄÂêé‰øÆÊîπ</span>
                        <span class="file-info-value" id="lastModified">-</span>
                    </div>
                </div>
            </div>
            
            <div class="upload-card-body">
                <div class="progress-section">
                    <div class="progress-header">
                        <div class="progress-title">‰∏ä‰º†ËøõÂ∫¶</div>
                        <div class="progress-percentage" id="progressPercentage">0%</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-stats">
                        <div class="stat-item upload-speed">
                            <span>‚ö°</span>
                            <span id="uploadSpeed">0 KB/s</span>
                        </div>
                        <div class="stat-item chunk-info">
                            <span>üì¶</span>
                            <span id="chunkInfo">0/0 ÂàÜÁâá</span>
                        </div>
                        <div class="stat-item time-remaining">
                            <span>‚è∞</span>
                            <span id="timeRemaining">ËÆ°ÁÆó‰∏≠...</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="upload-card-footer">
                <div class="controls">
                    <button class="btn" id="uploadBtn">
                        <span class="uploading-animation">üöÄ</span>
                        ÂºÄÂßã‰∏ä‰º†
                    </button>
                    <button class="btn btn-secondary" id="pauseBtn" disabled>
                        <span class="uploading-animation">‚è∏Ô∏è</span>
                        ÊöÇÂÅú
                    </button>
                    <button class="btn btn-secondary" id="resumeBtn" disabled>
                        <span class="uploading-animation">‚ñ∂Ô∏è</span>
                        ÁªßÁª≠
                    </button>
                    <button class="btn btn-danger" id="cancelBtn">
                        <span class="uploading-animation">‚ùå</span>
                        ÂèñÊ∂à
                    </button>
                </div>
            </div>
        </div>

        <div class="status" id="status"></div>

        <div class="history" id="history">
            <h2>‰∏ä‰º†ÂéÜÂè≤</h2>
            <div id="historyList"></div>
        </div>
    </div>

    <!-- ÂºπÁ™ó -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon" id="modalIcon">‚úì</div>
                <h3 class="modal-title" id="modalTitle">ÊèêÁ§∫</h3>
            </div>
            <div class="modal-body" id="modalBody">
                Êìç‰ΩúÂÆåÊàê
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-primary" onclick="fileUploader.closeModal()">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>

    <!-- Êñá‰ª∂‰øùÂ≠òÊúüÈôêÊèêÁ§∫ -->
    <div class="storage-notice">
        <span class="notice-icon">‚è∞</span>
        <span class="notice-text">Êñá‰ª∂‰∏ä‰º†Âêé‰ªÖ‰øùÂ≠ò2Â§©ÔºåËØ∑ÂèäÊó∂‰∏ãËΩΩ</span>
    </div>

    <script>
        // ÊúçÂä°Âô®APIÈÖçÁΩÆ
        const API_CONFIG = {
            baseUrl: window.location.origin,
            endpoints: {
                initUpload: '/api/upload/init',
                uploadChunk: '/api/upload/chunk',
                completeUpload: '/api/upload/complete',
                cancelUpload: '/api/upload',
                uploadStatus: '/api/upload',
                singleUpload: '/api/upload/single',
                listFiles: '/api/files',
                deleteFile: '/api/files'
            }
        };

        // ‰∏ä‰º†ÈÖçÁΩÆ
        const CHUNK_SIZE = 5 * 1024 * 1024; // 5MB
        const MAX_RETRIES = 3;

        class FileUploader {
            constructor() {
                this.file = null;
                this.uploadId = null;
                this.chunks = [];
                this.uploadedChunks = new Set();
                this.isPaused = false;
                this.isUploading = false;
                this.db = null;
                this.currentUpload = null;
                
                this.initDB().then(() => {
                    this.bindEvents();
                    this.loadHistory();
                }).catch(error => {
                    console.error('ÂàùÂßãÂåñÊï∞ÊçÆÂ∫ìÂ§±Ë¥•:', error);
                    this.bindEvents(); // Âç≥‰ΩøÊï∞ÊçÆÂ∫ìÂàùÂßãÂåñÂ§±Ë¥•Ôºå‰πüË¶ÅÁªëÂÆö‰∫ã‰ª∂
                });
            }

            async initDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open('FileUploadDB', 1);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve();
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('uploads')) {
                            const store = db.createObjectStore('uploads', { keyPath: 'uploadId' });
                            store.createIndex('filename', 'filename', { unique: false });
                            store.createIndex('timestamp', 'timestamp', { unique: false });
                        }
                        if (!db.objectStoreNames.contains('chunks')) {
                            const store = db.createObjectStore('chunks', { keyPath: 'id' });
                            store.createIndex('uploadId', 'uploadId', { unique: false });
                        }
                    };
                });
            }

            bindEvents() {
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');
                
                uploadArea.addEventListener('click', () => fileInput.click());
                uploadArea.addEventListener('dragover', this.handleDragOver.bind(this));
                uploadArea.addEventListener('drop', this.handleDrop.bind(this));
                uploadArea.addEventListener('dragleave', this.handleDragLeave.bind(this));
                
                fileInput.addEventListener('change', (e) => this.handleFileSelect(e.target.files[0]));
                
                document.getElementById('uploadBtn').addEventListener('click', () => this.startUpload());
                document.getElementById('pauseBtn').addEventListener('click', () => this.pauseUpload());
                document.getElementById('resumeBtn').addEventListener('click', () => this.resumeUpload());
                document.getElementById('cancelBtn').addEventListener('click', () => this.cancelUpload());
            }

            handleDragOver(e) {
                e.preventDefault();
                document.getElementById('uploadArea').classList.add('dragover');
            }

            handleDragLeave(e) {
                e.preventDefault();
                document.getElementById('uploadArea').classList.remove('dragover');
            }

            handleDrop(e) {
                e.preventDefault();
                document.getElementById('uploadArea').classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                this.handleFileSelect(file);
            }

            handleFileSelect(file) {
                if (!file) return;
                
                this.file = file;
                this.displayFileInfo(file);
                this.checkResumeCapability(file);
                document.getElementById('controls').style.display = 'block';
            }

            displayFileInfo(file) {
                const uploadCard = document.getElementById('uploadCard');
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = this.formatFileSize(file.size);
                document.getElementById('fileType').textContent = file.type || 'Êú™Áü•';
                document.getElementById('lastModified').textContent = new Date(file.lastModified).toLocaleString();
                uploadCard.style.display = 'block';
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            async checkResumeCapability(file) {
                if (!this.db) {
                    console.log('Êï∞ÊçÆÂ∫ìÊú™ÂàùÂßãÂåñÔºåË∑≥ËøáÊÅ¢Â§çÊ£ÄÊü•');
                    return;
                }
                
                const transaction = this.db.transaction(['uploads'], 'readonly');
                const store = transaction.objectStore('uploads');
                const index = store.index('filename');
                
                const request = index.getAll(file.name);
                request.onsuccess = () => {
                    const uploads = request.result;
                    const incompleteUpload = uploads.find(u => u.status === 'uploading');
                    
                    if (incompleteUpload) {
                        this.showModal('Ê£ÄÊµãÂà∞Êú™ÂÆåÊàêÁöÑ‰∏ä‰º†‰ªªÂä°ÔºåÂèØ‰ª•ÈÄâÊã©ÁªßÁª≠‰∏ä‰º†', 'info', 'ÊÅ¢Â§ç‰∏ä‰º†');
                        document.getElementById('resumeBtn').disabled = false;
                        this.currentUpload = incompleteUpload;
                    }
                };
            }

            async startUpload() {
                if (!this.file) return;
                
                this.isUploading = true;
                this.isPaused = false;
                this.updateButtons();
                
                try {
                    // ÂàùÂßãÂåñÂàÜÁâá‰∏ä‰º†
                    const uploadId = await this.initMultipartUpload();
                    this.uploadId = uploadId;
                    
                    // Á´ãÂç≥‰øùÂ≠ò‰∏ä‰º†ËÆ∞ÂΩï
                    this.saveUploadRecord('uploading');
                    
                    // ÂàõÂª∫ÂàÜÁâá
                    this.createChunks();
                    
                    // ÂºÄÂßã‰∏ä‰º†ÂàÜÁâá
                    await this.uploadChunks();
                    
                } catch (error) {
                    this.showStatus(`‰∏ä‰º†Â§±Ë¥•: ${error.message}`, 'error');
                    this.saveUploadRecord('failed');
                    this.resetUploadState();
                }
            }

            async initMultipartUpload() {
                try {
                    const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.initUpload}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            fileName: this.file.name,
                            fileSize: this.file.size,
                            chunkSize: CHUNK_SIZE
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`ÂàùÂßãÂåñ‰∏ä‰º†Â§±Ë¥•: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    return data.uploadId;
                } catch (error) {
                    console.error('ÂàùÂßãÂåñÂàÜÁâá‰∏ä‰º†Â§±Ë¥•:', error);
                    throw error;
                }
            }

            createChunks() {
                this.chunks = [];
                const totalChunks = Math.ceil(this.file.size / CHUNK_SIZE);
                
                for (let i = 0; i < totalChunks; i++) {
                    const start = i * CHUNK_SIZE;
                    const end = Math.min(start + CHUNK_SIZE, this.file.size);
                    
                    this.chunks.push({
                        index: i,
                        start,
                        end,
                        size: end - start,
                        retries: 0
                    });
                }
            }

            async uploadChunks() {
                const totalChunks = this.chunks.length;
                let uploadedCount = this.uploadedChunks.size;
                let startTime = Date.now();
                let lastUploadedSize = 0;
                let lastUpdateTime = startTime;
                
                for (const chunk of this.chunks) {
                    if (this.uploadedChunks.has(chunk.index)) continue;
                    if (this.isPaused) break;
                    
                    try {
                        const chunkStartTime = Date.now();
                        await this.uploadChunk(chunk);
                        const chunkEndTime = Date.now();
                        
                        this.uploadedChunks.add(chunk.index);
                        uploadedCount++;
                        
                        // ËÆ°ÁÆó‰∏ä‰º†ÈÄüÂ∫¶ÂíåÂâ©‰ΩôÊó∂Èó¥
                        const currentTime = Date.now();
                        const elapsedTime = (currentTime - startTime) / 1000; // Áßí
                        const uploadedSize = uploadedCount * CHUNK_SIZE;
                        
                        let uploadSpeed = 0;
                        let timeRemaining = null;
                        
                        if (elapsedTime > 0) {
                            uploadSpeed = uploadedSize / elapsedTime; // Â≠óËäÇ/Áßí
                            
                            if (uploadSpeed > 0) {
                                const remainingSize = this.file.size - uploadedSize;
                                timeRemaining = remainingSize / uploadSpeed; // Áßí
                            }
                        }
                        
                        // Êõ¥Êñ∞ËøõÂ∫¶
                        const progress = (uploadedCount / totalChunks) * 100;
                        this.updateProgress(progress, uploadedCount, totalChunks, uploadSpeed, timeRemaining);
                        
                        // ‰øùÂ≠òÂàÜÁâá‰∏ä‰º†Áä∂ÊÄÅ
                        this.saveChunkStatus(chunk.index);
                        
                    } catch (error) {
                        if (chunk.retries < MAX_RETRIES) {
                            chunk.retries++;
                            console.log(`ÂàÜÁâá ${chunk.index} ‰∏ä‰º†Â§±Ë¥•ÔºåÈáçËØï ${chunk.retries}/${MAX_RETRIES}`);
                            continue;
                        } else {
                            throw new Error(`ÂàÜÁâá ${chunk.index} ‰∏ä‰º†Â§±Ë¥•: ${error.message}`);
                        }
                    }
                }
                
                if (!this.isPaused && uploadedCount === totalChunks) {
                    // ÂÆåÊàê‰∏ä‰º†
                    const downloadUrl = await this.completeUpload();
                    this.showModal('Êñá‰ª∂‰∏ä‰º†ÂÆåÊàêÔºÅ', 'success', '‰∏ä‰º†ÊàêÂäü');
                    this.saveUploadRecord('completed', downloadUrl);
                    this.loadHistory();
                    
                    // ÈáçÁΩÆ‰∏ä‰º†Áä∂ÊÄÅ
                    this.resetUploadState();
                }
            }

            async uploadChunk(chunk) {
                const blob = this.file.slice(chunk.start, chunk.end);
                const formData = new FormData();
                formData.append('chunk', blob);
                formData.append('uploadId', this.uploadId);
                formData.append('chunkIndex', chunk.index);
                
                try {
                    const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.uploadChunk}`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error(`ÂàÜÁâá‰∏ä‰º†Â§±Ë¥•: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    console.log(`ÂàÜÁâá ${chunk.index} ‰∏ä‰º†ÊàêÂäü`, data);
                    return data;
                } catch (error) {
                    console.error(`ÂàÜÁâá ${chunk.index} ‰∏ä‰º†Â§±Ë¥•:`, error);
                    throw error;
                }
            }

            async completeUpload() {
                try {
                    const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.completeUpload}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            uploadId: this.uploadId
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`ÂÆåÊàê‰∏ä‰º†Â§±Ë¥•: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    return data.downloadUrl;
                } catch (error) {
                    console.error('ÂÆåÊàê‰∏ä‰º†Â§±Ë¥•:', error);
                    throw error;
                }
            }

            pauseUpload() {
                this.isPaused = true;
                this.isUploading = false;
                this.updateButtons();
                this.showModal('‰∏ä‰º†Â∑≤ÊöÇÂÅú', 'info', 'ÊöÇÂÅú‰∏ä‰º†');
            }

            resumeUpload() {
                if (this.uploadId && this.file) {
                    // Â¶ÇÊûúÊúâÂΩìÂâçÁöÑ‰∏ä‰º†‰ªªÂä°ÔºåÁªßÁª≠‰∏ä‰º†
                    this.isPaused = false;
                    this.isUploading = true;
                    this.uploadChunks();
                } else {
                    this.showModal('Ê≤°ÊúâÂèØÊÅ¢Â§çÁöÑ‰∏ä‰º†‰ªªÂä°', 'error', 'Êó†Ê≥ïÊÅ¢Â§ç');
                }
                this.updateButtons();
            }

            async resumeFromHistory(uploadId) {
                if (!this.db) {
                    console.error('Êï∞ÊçÆÂ∫ìÊú™ÂàùÂßãÂåñÔºåÊó†Ê≥ïÊÅ¢Â§ç‰∏ä‰º†');
                    return;
                }
                
                try {
                    // ‰ªéIndexedDBËé∑Âèñ‰∏ä‰º†ËÆ∞ÂΩï
                    const uploadTransaction = this.db.transaction(['uploads'], 'readonly');
                    const uploadStore = uploadTransaction.objectStore('uploads');
                    const uploadRequest = uploadStore.get(uploadId);
                    
                    uploadRequest.onsuccess = async () => {
                        const uploadRecord = uploadRequest.result;
                        if (!uploadRecord) {
                            this.showModal('Êâæ‰∏çÂà∞‰∏ä‰º†ËÆ∞ÂΩï', 'error', 'ÊÅ¢Â§çÂ§±Ë¥•');
                            return;
                        }

                        // ÊÅ¢Â§çÊñá‰ª∂‰ø°ÊÅØ
                        this.file = {
                            name: uploadRecord.filename,
                            size: uploadRecord.size,
                            type: uploadRecord.type
                        };
                        this.uploadId = uploadRecord.uploadId;

                        // ÊòæÁ§∫Êñá‰ª∂‰ø°ÊÅØ
                        this.displayFileInfo(this.file); // ‰øÆÊ≠£ÔºöÈúÄË¶Å‰º†ÂÖ•Êñá‰ª∂ÂØπË±°

                        // ‰ªéIndexedDBÊÅ¢Â§çÂàÜÁâáÁä∂ÊÄÅ
                        const chunkTransaction = this.db.transaction(['chunks'], 'readonly');
                        const chunkStore = chunkTransaction.objectStore('chunks');
                        const chunkIndex = chunkStore.index('uploadId');
                        
                        const chunkRequest = chunkIndex.getAll(uploadId);
                        chunkRequest.onsuccess = () => {
                            const chunks = chunkRequest.result;
                            chunks.forEach(chunk => {
                                this.uploadedChunks.add(chunk.chunkIndex);
                            });
                            
                            // ÈáçÊñ∞ÂàõÂª∫ÂàÜÁâáÂπ∂ÁªßÁª≠‰∏ä‰º†
                            this.createChunks();
                            this.isUploading = true;
                            this.isPaused = false;
                            this.updateButtons();
                            this.uploadChunks();
                        };
                    };
                } catch (error) {
                    console.error('ÊÅ¢Â§ç‰∏ä‰º†Â§±Ë¥•:', error);
                    this.showModal('ÊÅ¢Â§ç‰∏ä‰º†Â§±Ë¥•', 'error', 'ÊÅ¢Â§çÂ§±Ë¥•');
                }
            }

            cancelUpload(uploadId = null) {
                if (uploadId) {
                    // ÂèñÊ∂àÊåáÂÆöÁöÑ‰∏ä‰º†‰ªªÂä°
                    this.deleteHistoryRecord(uploadId);
                } else {
                    // ÂèñÊ∂àÂΩìÂâçÁöÑ‰∏ä‰º†‰ªªÂä°
                    this.resetUploadState();
                    this.showModal('‰∏ä‰º†Â∑≤ÂèñÊ∂à', 'info', 'ÂèñÊ∂à‰∏ä‰º†');
                }
            }

            resetUploadState() {
                // ÈáçÁΩÆÊâÄÊúâ‰∏ä‰º†Áõ∏ÂÖ≥ÁöÑÁä∂ÊÄÅ
                this.isUploading = false;
                this.isPaused = false;
                this.uploadId = null;
                this.file = null;
                this.chunks = [];
                this.uploadedChunks.clear();
                this.currentUpload = null;
                
                // ÈáçÁΩÆUIÁä∂ÊÄÅ
                this.updateButtons();
                document.getElementById('uploadCard').style.display = 'none';
                
                // ÈáçÁΩÆÊñá‰ª∂ËæìÂÖ•
                document.getElementById('fileInput').value = '';
            }

            updateProgress(progress, uploaded = 0, total = 0, uploadSpeed = 0, timeRemaining = null) {
                document.getElementById('progressFill').style.width = `${progress}%`;
                document.getElementById('progressPercentage').textContent = `${Math.round(progress)}%`;
                
                if (uploaded > 0 && total > 0) {
                    document.getElementById('chunkInfo').textContent = `${uploaded}/${total} ÂàÜÁâá`;
                }
                
                if (uploadSpeed > 0) {
                    const speedText = uploadSpeed > 1024 * 1024 ? 
                        `${(uploadSpeed / (1024 * 1024)).toFixed(1)} MB/s` : 
                        `${(uploadSpeed / 1024).toFixed(1)} KB/s`;
                    document.getElementById('uploadSpeed').textContent = speedText;
                }
                
                if (timeRemaining !== null) {
                    const timeText = timeRemaining === Infinity ? 'ËÆ°ÁÆó‰∏≠...' : 
                        this.formatTime(timeRemaining);
                    document.getElementById('timeRemaining').textContent = timeText;
                }
            }

            formatTime(seconds) {
                if (seconds < 60) {
                    return `${Math.round(seconds)}Áßí`;
                } else if (seconds < 3600) {
                    return `${Math.floor(seconds / 60)}ÂàÜ${Math.round(seconds % 60)}Áßí`;
                } else {
                    const hours = Math.floor(seconds / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    return `${hours}Êó∂${minutes}ÂàÜ`;
                }
            }

            updateButtons() {
                const uploadBtn = document.getElementById('uploadBtn');
                const pauseBtn = document.getElementById('pauseBtn');
                const resumeBtn = document.getElementById('resumeBtn');
                const cancelBtn = document.getElementById('cancelBtn');

                if (this.isUploading) {
                    uploadBtn.disabled = true;
                    pauseBtn.disabled = this.isPaused;
                    resumeBtn.style.display = this.isPaused ? 'inline-flex' : 'none';
                    cancelBtn.disabled = false;
                } else {
                    uploadBtn.disabled = false;
                    pauseBtn.disabled = true;
                    resumeBtn.style.display = 'none';
                    cancelBtn.disabled = true;
                }
            }

            showStatus(message, type) {
                // Êîπ‰∏∫ÂºπÁ™óÊòæÁ§∫
                this.showModal(message, type);
            }

            showModal(message, type = 'info', title = null) {
                const modal = document.getElementById('modal');
                const modalIcon = document.getElementById('modalIcon');
                const modalTitle = document.getElementById('modalTitle');
                const modalBody = document.getElementById('modalBody');

                // ËÆæÁΩÆÂõæÊ†áÂíåÊ†∑Âºè
                modalIcon.className = `modal-icon ${type}`;
                switch(type) {
                    case 'success':
                        modalIcon.textContent = '‚úì';
                        modalTitle.textContent = title || 'ÊàêÂäü';
                        break;
                    case 'error':
                        modalIcon.textContent = '‚úï';
                        modalTitle.textContent = title || 'ÈîôËØØ';
                        break;
                    case 'info':
                    default:
                        modalIcon.textContent = '‚Ñπ';
                        modalTitle.textContent = title || 'ÊèêÁ§∫';
                        break;
                }

                modalBody.textContent = message;
                modal.classList.add('show');

                // 3ÁßíÂêéËá™Âä®ÂÖ≥Èó≠
                setTimeout(() => {
                    this.closeModal();
                }, 3000);
            }

            closeModal() {
                const modal = document.getElementById('modal');
                modal.classList.remove('show');
            }

            async saveUploadRecord(status, downloadUrl = null) {
                if (!this.db) {
                    console.log('Êï∞ÊçÆÂ∫ìÊú™ÂàùÂßãÂåñÔºåË∑≥Ëøá‰øùÂ≠ò‰∏ä‰º†ËÆ∞ÂΩï');
                    return;
                }
                
                if (!this.uploadId) {
                    console.log('Ê≤°ÊúâuploadIdÔºåË∑≥Ëøá‰øùÂ≠ò‰∏ä‰º†ËÆ∞ÂΩï');
                    return;
                }
                
                const record = {
                    uploadId: this.uploadId,
                    filename: this.file.name,
                    size: this.file.size,
                    type: this.file.type,
                    timestamp: new Date().toISOString(),
                    status,
                    downloadUrl
                };
                
                const transaction = this.db.transaction(['uploads'], 'readwrite');
                const store = transaction.objectStore('uploads');
                store.put(record);
            }

            saveChunkStatus(chunkIndex) {
                if (!this.db) {
                    console.log('Êï∞ÊçÆÂ∫ìÊú™ÂàùÂßãÂåñÔºåË∑≥Ëøá‰øùÂ≠òÂàÜÁâáÁä∂ÊÄÅ');
                    return;
                }
                
                const chunkRecord = {
                    id: `${this.uploadId}_${chunkIndex}`,
                    uploadId: this.uploadId,
                    chunkIndex,
                    timestamp: new Date().toISOString()
                };
                
                const transaction = this.db.transaction(['chunks'], 'readwrite');
                const store = transaction.objectStore('chunks');
                store.put(chunkRecord);
            }

            loadHistory() {
                if (!this.db) {
                    console.log('Êï∞ÊçÆÂ∫ìÊú™ÂàùÂßãÂåñÔºåË∑≥ËøáÂä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩï');
                    document.getElementById('historyList').innerHTML = '<p style="text-align: center; color: #999;">ÊöÇÊó†‰∏ä‰º†ËÆ∞ÂΩï</p>';
                    return;
                }
                
                const transaction = this.db.transaction(['uploads'], 'readonly');
                const store = transaction.objectStore('uploads');
                const index = store.index('timestamp');
                
                const request = index.openCursor(null, 'prev');
                const history = [];
                
                request.onsuccess = (event) => {
                    const cursor = event.target.result;
                    if (cursor && history.length < 10) {
                        history.push(cursor.value);
                        cursor.continue();
                    } else {
                        this.displayHistory(history);
                    }
                };
            }

            displayHistory(history) {
                const historyContainer = document.getElementById('historyList');
                
                if (!history || history.length === 0) {
                    historyContainer.innerHTML = '<p style="text-align: center; color: #999;">ÊöÇÊó†‰∏ä‰º†ËÆ∞ÂΩï</p>';
                    return;
                }

                historyContainer.innerHTML = history.map(record => {
                    const statusText = this.getStatusText(record.status);
                    const statusClass = record.status;
                    
                    return `
                    <div class="history-item ${statusClass}" data-upload-id="${record.uploadId}">
                        <div class="history-info">
                            <div class="history-name">${record.filename}</div>
                            <div class="history-meta">
                                ${this.formatFileSize(record.size)} ‚Ä¢ 
                                <span class="status-badge ${statusClass}">${statusText}</span> ‚Ä¢ 
                                ${new Date(record.timestamp).toLocaleString()}
                            </div>
                        </div>
                        <div class="history-actions">
                            ${record.status === 'uploading' ? 
                                `<button class="btn-resume" onclick="fileUploader.resumeFromHistory('${record.uploadId}')">
                                    ‚ñ∂Ô∏è ÁªßÁª≠‰∏ä‰º†
                                </button>` : ''
                            }
                            ${record.downloadUrl ? 
                                `<a href="${record.downloadUrl}" target="_blank" class="history-item-link">‰∏ãËΩΩ</a>` : ''
                            }
                            <button class="btn-cancel" onclick="fileUploader.deleteHistoryRecord('${record.uploadId}')">
                                ‚ùå Âà†Èô§ËÆ∞ÂΩï
                            </button>
                        </div>
                    </div>
                `;
                }).join('');
            }

            getStatusText(status) {
                const statusMap = {
                    'uploading': '‰∏ä‰º†‰∏≠',
                    'completed': 'Â∑≤ÂÆåÊàê',
                    'failed': 'Â§±Ë¥•'
                };
                return statusMap[status] || status;
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            async deleteHistoryRecord(uploadId) {
                if (!this.db) {
                    console.error('Êï∞ÊçÆÂ∫ìÊú™ÂàùÂßãÂåñÔºåÊó†Ê≥ïÂà†Èô§ËÆ∞ÂΩï');
                    this.showStatus('Êï∞ÊçÆÂ∫ìÊú™ÂàùÂßãÂåñÔºåÊó†Ê≥ïÂà†Èô§ËÆ∞ÂΩï', 'error');
                    return;
                }

                try {
                    // Âà†Èô§‰∏ä‰º†ËÆ∞ÂΩï
                    const uploadTransaction = this.db.transaction(['uploads'], 'readwrite');
                    const uploadStore = uploadTransaction.objectStore('uploads');
                    
                    await new Promise((resolve, reject) => {
                        const deleteRequest = uploadStore.delete(uploadId);
                        deleteRequest.onsuccess = () => resolve();
                        deleteRequest.onerror = () => reject(deleteRequest.error);
                    });

                    // Âà†Èô§Áõ∏ÂÖ≥ÁöÑÂàÜÁâáËÆ∞ÂΩï
                    const chunkTransaction = this.db.transaction(['chunks'], 'readwrite');
                    const chunkStore = chunkTransaction.objectStore('chunks');
                    const chunkIndex = chunkStore.index('uploadId');
                    
                    await new Promise((resolve, reject) => {
                        const chunkRequest = chunkIndex.openCursor(IDBKeyRange.only(uploadId));
                        chunkRequest.onsuccess = (event) => {
                            const cursor = event.target.result;
                            if (cursor) {
                                cursor.delete();
                                cursor.continue();
                            } else {
                                resolve();
                            }
                        };
                        chunkRequest.onerror = () => reject(chunkRequest.error);
                    });

                    this.showModal('ËÆ∞ÂΩïÂ∑≤Âà†Èô§', 'success', 'Âà†Èô§ÊàêÂäü');
                    this.loadHistory(); // ÈáçÊñ∞Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩï
                } catch (error) {
                    console.error('Âà†Èô§ËÆ∞ÂΩïÂ§±Ë¥•:', error);
                    this.showModal('Âà†Èô§ËÆ∞ÂΩïÂ§±Ë¥•', 'error', 'Âà†Èô§Â§±Ë¥•');
                }
            }
        }

        // ÂàùÂßãÂåñ‰∏ä‰º†Âô®
        let fileUploader;
        
        document.addEventListener('DOMContentLoaded', () => {
            fileUploader = new FileUploader();
        });
    </script>
</body>
</html>